<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SK1 Dumper</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: #1e1e2f;
            color: white;
            overflow-x: hidden;
        }
        .header, .footer {
            text-align: center;
            padding: 20px;
            background: #121223;
        }
        .header h1, .footer p {
            margin: 0;
            font-size: 1.5em;
        }
        .container {
            padding: 20px;
            text-align: center;
        }
        .subtitle {
            margin: 10px 0 20px;
            font-size: 1.2em;
        }
        .file-upload {
            margin: 20px auto;
        }
        #dumpFile {
            margin-right: 10px;
        }
        .progress-container {
            width: 50%;
            margin: 20px auto;
            height: 20px;
            background: #444;
            border-radius: 10px;
            overflow: hidden;
            display: none;
        }
        .progress-bar {
            height: 100%;
            background: #4caf50;
            text-align: center;
            line-height: 20px;
            color: white;
            width: 0;
        }
        table {
            margin: 20px auto;
            width: 90%;
            border-collapse: collapse;
            background: #252539;
            color: white;
        }
        table th, table td {
            padding: 10px;
            border: 1px solid #444;
            text-align: center;
        }
        table th {
            background: #121223;
        }
        #downloadLink {
            display: none;
            margin-top: 20px;
            color: #4caf50;
            text-decoration: none;
        }
    </style>
</head>
<body>

    <div class="header">
        <h1>Mini Militia Dumper</h1>
    </div>

    <div class="container">
        <p class="subtitle">Upload a .txt Dump File & Extract Offsets</p>
        <div class="file-upload">
            <input type="file" id="dumpFile" accept=".txt">
            <button id="processDump">Search & Extract</button>
        </div>

        <div class="progress-container" id="progressContainer">
            <div class="progress-bar" id="progressBar">0%</div>
        </div>

        <table>
            <thead>
                <tr>
                    <th>Mod Name</th>
                    <th>Offset</th>
                    <th>Patch</th>
                </tr>
            </thead>
            <tbody id="resultsTableBody"></tbody>
        </table>

        <a id="downloadLink" href="#">Download Extracted Data</a>
    </div>

    <div class="footer">
        <p>&copy; 2025 Developed by Siwam King1</p>
    </div>

    <script>
        const functions = [
            { fn: "MAX LEVEL", fn2: "_ZNK11UserProfile5levelEv", patch: "6400A0E31EFF2FE1" },
            { fn: "MAX XP", fn2: "_ZNK11UserProfile2xpEv", patch: "FF090CE30010A0E39A0B43E31EFF2FE1" },
            { fn: "Fake Enemy Information", fn2: "_ZNK10PlayerInfo5levelEv", patch: "5000A0E31EFF2FE1" },
            { fn: "Unlock Everything", fn2: "_ZNK10UserWallet15quantityOwnedOfERKNSt6__ndk112basic_stringIcNS0_11char_traitsIcEENS0_9allocatorIcEEEE", patch: "5000A0E31EFF2FE1A" },
            { fn: "MAX Level Weapon", fn2: "_ZNK10UserWallet22maxOwnedLevelForWeaponERKNSt6__ndk112basic_stringIcNS0_11char_traitsIcEENS0_9allocatorIcEEEE", patch: "5000A0E31EFF2FE1" },
            { fn: "Magik Zoom2", fn2: "_ZN6Weapon15changeZoomLevelEv", patch: "00 00 55 E1 FA 15 A0 03 60 11 84 05 07 00 00 0A 00 10 A0 83 5C 11 84 85" }
        ];

        const processDumpButton = document.getElementById('processDump');
        const resultsTableBody = document.getElementById('resultsTableBody');
        const progressBar = document.getElementById('progressBar');
        const progressContainer = document.getElementById('progressContainer');
        const downloadLink = document.getElementById('downloadLink');

        processDumpButton.addEventListener('click', () => {
            const fileInput = document.getElementById('dumpFile');
            const file = fileInput.files[0];

            if (!file) {
                alert('Please upload a dump file.');
                return;
            }

            const reader = new FileReader();
            reader.onload = (event) => {
                const content = event.target.result;
                processDump(content);
            };
            reader.readAsText(file);
        });

        function processDump(content) {
            resultsTableBody.innerHTML = '';
            progressBar.style.width = '0%';
            progressContainer.style.display = 'block';

            const lines = content.split('\n');
            let extractedData = '';
            let foundCount = 0;

            functions.forEach((func, index) => {
                let foundOffset = 'Not found';
                lines.forEach(line => {
                    if (line.includes(func.fn2)) {
                        const offsetMatch = line.match(/0x[\da-fA-F]+/);
                        if (offsetMatch) {
                            foundOffset = offsetMatch[0];
                        }
                    }
                });

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${func.fn}</td>
                    <td>${foundOffset}</td>
                    <td>${func.patch}</td>
                `;
                resultsTableBody.appendChild(row);

                extractedData += `Mod: ${func.fn}\nOffset: ${foundOffset}\nPatch: ${func.patch}\n\n`;

                foundCount++;
                progressBar.style.width = `${((index + 1) / functions.length) * 100}%`;
            });

            progressBar.style.width = '100%';
            downloadExtractedData(extractedData);
        }

        function downloadExtractedData(data) {
            const blob = new Blob([data], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            downloadLink.href = url;
            downloadLink.download = 'extracted_data_sk1.txt';
            downloadLink.style.display = 'block';
            downloadLink.innerText = 'Download Extracted Data';
        }
    </script>
</body>
</html>
